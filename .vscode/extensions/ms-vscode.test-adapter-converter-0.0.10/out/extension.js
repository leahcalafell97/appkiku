var R=Object.create,l=Object.defineProperty,E=Object.getPrototypeOf,x=Object.prototype.hasOwnProperty,k=Object.getOwnPropertyNames,S=Object.getOwnPropertyDescriptor;var g=o=>l(o,"__esModule",{value:!0});var M=(o,e)=>()=>(e||o((e={exports:{}}).exports,e),e.exports),A=(o,e)=>{for(var t in e)l(o,t,{get:e[t],enumerable:!0})},F=(o,e,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of k(e))!x.call(o,r)&&r!=="default"&&l(o,r,{get:()=>e[r],enumerable:!(t=S(e,r))||t.enumerable});return o},p=o=>F(g(l(o!=null?R(E(o)):{},"default",o&&o.__esModule&&"default"in o?{get:()=>o.default,enumerable:!0}:{value:o,enumerable:!0})),o);var m=M(u=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0});u.testExplorerExtensionId=void 0;u.testExplorerExtensionId="hbenl.vscode-test-explorer"});g(exports);A(exports,{activate:()=>L});var f=p(require("vscode")),w=p(m());var C=p(require("vscode"));var s=p(require("vscode")),D=0,B=0,h=class{constructor(e){this.adapter=e;this.root=s.test.createTestItem({id:`test-adapter-root-${B++}`,label:"Test Adapter",uri:this.adapter.workspaceFolder?.uri??s.workspace.workspaceFolders?.[0]?.uri??s.Uri.file("/")},{generation:0});this.itemsById=new Map([[this.root.id,this.root]]);this.tasksByRunId=new Map;this.disposables=[];this.hasRequestedLoad=!1;this.disposables.push(e.tests(t=>{t.type==="finished"&&t.suite&&(this.syncItemChildren(this.root,D++,[t.suite]),q())}),e.testStates(t=>{let r=this.tasksByRunId.get(t.testRunId??"");if(!!r)switch(t.type){case"test":return this.onTestEvent(r,t);case"suite":return;case"finished":return r.end()}})),e.retire&&this.disposables.push(e.retire(t=>{for(let r of t.tests??[this.root.id])this.itemsById.get(r)?.invalidate()}))}createWorkspaceTestRoot(e){if(this.adapter.workspaceFolder){if(e!==this.adapter.workspaceFolder)return}else if(e!==s.workspace.workspaceFolders?.[0])return;return this.hasRequestedLoad||(this.adapter.load(),this.hasRequestedLoad=!0),this.root}async runTests(e,t){let r=e.tests.length===1&&e.tests[0]===this.root?[...this.root.children.values()]:e.tests,i,n=await new Promise(c=>{i=this.adapter.testStates(d=>{d.type==="started"&&(c(d),i.dispose())}),e.debug?this.adapter.debug?this.adapter.debug(r.map(d=>d.id)):c(void 0):this.adapter.run(r.map(d=>d.id))}).finally(()=>i.dispose());if(!n)return;let a=s.test.createTestRun(e),v=[r];for(;v.length;)for(let c of v.pop())a.setState(c,s.TestResultState.Queued),v.push(c.children.values());this.tasksByRunId.set(n.testRunId??"",a),t.onCancellationRequested(()=>this.adapter.cancel())}addItem(e,t,r){let i=r.children.get(e.id);return i?i.data.generation=t:(i=s.test.createTestItem({id:e.id,label:e.label,uri:e.file?I(e.file):r.uri},{generation:t}),this.itemsById.set(e.id,i),r.addChild(i)),i.description=e.description,e.line!==void 0&&(i.range=new s.Range(e.line,0,e.line+1,0)),i.description=e.description,i.debuggable=!!this.adapter.debug,e.errored&&(i.error=e.message),this.syncItemChildren(i,t,"children"in e?e.children:[]),i}syncItemChildren(e,t,r){for(let i of r)this.addItem(i,t,e);for(let i of e.children.values())i.data.generation!==t&&(i.dispose(),this.itemsById.delete(i.id))}onTestEvent(e,t){let r=typeof t.test=="string"?t.test:t.test.id,i=this.itemsById.get(r);if(!!i){if(t.message){let n=new s.TestMessage(t.message);n.severity=s.TestMessageSeverity.Information,e.appendMessage(i,n)}for(let n of t.decorations??[]){let a=new s.TestMessage(n.message);a.location=new s.Location(n.file?I(n.file):i.uri,new s.Position(n.line,0)),e.appendMessage(i,a)}e.setState(i,U[t.state])}}},P=/^[a-z][a-z0-9+-.]+:/,I=o=>P.test(o)?s.Uri.parse(o):s.Uri.file(o),U={running:s.TestResultState.Running,passed:s.TestResultState.Passed,failed:s.TestResultState.Failed,skipped:s.TestResultState.Skipped,errored:s.TestResultState.Errored,completed:s.TestResultState.Unset},b=["testExplorer.gutterDecoration","testExplorer.codeLens","testExplorer.errorDecoration","testExplorer.errorDecorationHover"],y=s.workspace.getConfiguration().get(b[0])!==!1,q=async()=>{if(!y)return;y=!1;let o="Yes",e="Only in this Workspace",t="No",r=await s.window.showInformationMessage("Thanks for trying out native VS Code testing! Would you like to disable the default Test Explorer extension UI?",t,o,e);if(r===o||r===e){let i=r===o?s.ConfigurationTarget.Global:s.ConfigurationTarget.Workspace,n=s.workspace.getConfiguration();for(let a of b)n.update(a,!1,i)}};var T=class{constructor(){this.disposables=new Map}registerTestAdapter(e){this.disposables.set(e,C.test.registerTestController(new h(e)))}unregisterTestAdapter(e){this.disposables.get(e)?.dispose(),this.disposables.delete(e)}dispose(){for(let e of this.disposables.values())e.dispose()}};function L(o){o.subscriptions.push(f.commands.registerCommand("testExplorerConverter.activate",()=>{let e=f.extensions.getExtension(w.testExplorerExtensionId);if(!e)return;let t=e.exports,r=new T;o.subscriptions.push(r),t.registerTestController(r),o.subscriptions.push({dispose(){t.unregisterTestController(r)}})}))}0&&(module.exports={activate});
